var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{h(i.next(e))}catch(t){a(t)}}function s(e){try{h(i["throw"](e))}catch(t){a(t)}}function h(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,s)}h((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,a=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){h.label=r[1];break}if(6===r[0]&&h.label<o[1]){h.label=o[1],o=r;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(r);break}o[2]&&h.ops.pop(),h.trys.pop();continue}r=t.call(e,h)}catch(i){r=[6,i],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,r){function i(i){t.call(r,i,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?i(n):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var RotateCtrlBt=function(e){function t(t,r){var i=e.call(this)||this;return i._row=t,i._col=r,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(t,e),t.prototype.onAddToStage=function(e){this.draw()},t.prototype.draw=function(){this.graphics.beginFill(3372970,1),this.graphics.lineStyle(2,65399),this.graphics.drawCircle(0,0,15),this.graphics.drawCircle(0,0,9),this.graphics.endFill(),this.touchEnabled=!0},t}(egret.Shape);__reflect(RotateCtrlBt.prototype,"RotateCtrlBt");var Triangle=function(e){function t(t,r,i,n,a,o,s){var h=e.call(this)||this;return h.x1=t,h.x2=i,h.x3=a,h.y1=r,h.y2=n,h.y3=o,h.color=s,h.addEventListener(egret.Event.ADDED_TO_STAGE,h.onAddToStage,h),h}return __extends(t,e),t.prototype.onAddToStage=function(e){this.draw()},t.prototype.setColor=function(e){this.color=e},t.prototype.draw=function(){this.graphics.lineStyle(2,16777215),this.graphics.beginFill(this.color,1),this.graphics.moveTo(this.x1,this.y1),this.graphics.lineTo(this.x2,this.y2),this.graphics.lineTo(this.x3,this.y3),this.graphics.lineTo(this.x1,this.y1),this.graphics.endFill()},t}(egret.Shape);__reflect(Triangle.prototype,"Triangle");var Game=function(){function e(){this._board=e.target_board,this.isStarted=!1}return Object.defineProperty(e.prototype,"Board",{get:function(){return this._board},enumerable:!0,configurable:!0}),Object.defineProperty(e,"target_board",{get:function(){return[[1,2,2,2,2,2,3],[1,1,1,2,2,2,3,3,3],[1,1,1,1,1,2,3,3,3,3,3],[4,4,4,4,4,5,6,6,6,6,6],[4,4,4,5,5,5,6,6,6],[4,5,5,5,5,5,6]]},enumerable:!0,configurable:!0}),e.Vertexes=function(){for(var t=[],r=0;r<e.VERTEX_DIM.length;r++){for(var i=[],n=0;n<e.VERTEX_DIM[r];n++){var a=50*Math.abs(r-3)+100*n;i.push([a,100*r])}t.push(i)}return t},e.prototype.start=function(t){for(var r=1==t?10:50,i=0;r>i;i++){var n=Math.floor(Math.random()*e.CTRL_DIM.length)+1,a=Math.floor(Math.random()*e.CTRL_DIM[n-1])+1;this.rotate(n,a)}this.isStarted=!0},e.prototype.rotate=function(t,r){if(egret.log("init click:"+t+" , "+r),!(1>t||t>e.CTRL_DIM.length||1>r||r>e.CTRL_DIM[t])){var i=3>=t?2*r-2:2*r-1,n=2>=t?2*r-1:2*r-2,a=this._board[t][n];this._board[t][n]=this._board[t][n+1],this._board[t][n+1]=this._board[t][n+2],this._board[t][n+2]=this._board[t-1][i+2],this._board[t-1][i+2]=this._board[t-1][i+1],this._board[t-1][i+1]=this._board[t-1][i],this._board[t-1][i]=a}},e.prototype.check=function(){for(var t=0;t<e.target_board.length;t++)for(var r=0;r<e.target_board[t].length;r++)if(this._board[t][r]!=e.target_board[t][r])return egret.log("check faled: "+t+" , "+r+":"+this._board[t][r]+" vs "+e.target_board[t][r]),!1;return egret.log("check OK!"),!0},e.VERTEX_DIM=[4,5,6,7,6,5,4],e.BOARD_DIM=[7,9,11,11,9,7],e.CTRL_DIM=[3,4,5,4,3],e}();__reflect(Game.prototype,"Game");var colorMap={1:16711680,2:65535,3:255,4:16776960,5:65280,6:16711935},game=new Game,GameBoard=function(e){function t(t){void 0===t&&(t=!1);var r=e.call(this)||this;return r.isPreviw=t,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAddToStage,r),r}return __extends(t,e),t.prototype.initGraphic=function(){var e=this;this._rotatebts=[],this._triangles={};for(var t=Game.Vertexes(),r=0;r<Game.BOARD_DIM.length;r++)for(var i=0;i<Game.BOARD_DIM[r];i++){var n=void 0,a=void 0,o=void 0,s=void 0,h=void 0,l=void 0;r<Game.BOARD_DIM.length/2&&i%2!=0?(f=t[r][(i-1)/2],n=f[0],s=f[1],_=t[r][(i-1)/2+1],a=_[0],h=_[1],v=t[r+1][(i+1)/2],o=v[0],l=v[1]):r<Game.BOARD_DIM.length/2&&i%2==0?(y=t[r][i/2],n=y[0],s=y[1],m=t[r+1][i/2+1],a=m[0],h=m[1],w=t[r+1][i/2],o=w[0],l=w[1]):r>=Game.BOARD_DIM.length/2&&i%2!=0?(T=t[r][(i-1)/2+1],n=T[0],s=T[1],E=t[r+1][(i-1)/2],a=E[0],h=E[1],x=t[r+1][(i-1)/2+1],o=x[0],l=x[1]):r>=Game.BOARD_DIM.length/2&&i%2==0&&(R=t[r][i/2],n=R[0],s=R[1],b=t[r][i/2+1],a=b[0],h=b[1],C=t[r+1][i/2],o=C[0],l=C[1]);var c=colorMap[Game.target_board[r][i]],d=new Triangle(n,s,a,h,o,l,c);d.y=250,d.x=20,d.alpha=.4,this._triangles[r+"_"+i]=d,this.addChild(d)}if(!this.isPreviw)for(var r=0;5>r;r++)for(var u=5-Math.abs(r-2),g=function(t){var i=100+50*Math.abs(r-2)+100*t,n=100*(r+1),a=new RotateCtrlBt(r+1,t+1);a.x=i+20,a.y=n+250,p._rotatebts.push(a),p.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){a=t.currentTarget,game.isStarted&&e.rotate(a._row,a._col)},p)},p=this,i=0;u>i;i++)g(i);var f,_,v,y,m,w,T,E,x,R,b,C},t.prototype.rotate=function(e,t){if(!(1>e||e>Game.CTRL_DIM.length||1>t||t>Game.CTRL_DIM[e-1])){var r=3>=e?2*t-2:2*t-1,i=2>=e?2*t-1:2*t-2,n=game.Board,a=n[e][i];n[e][i]=n[e][i+1],n[e][i+1]=n[e][i+2],n[e][i+2]=n[e-1][r+2],n[e-1][r+2]=n[e-1][r+1],n[e-1][r+1]=n[e-1][r],n[e-1][r]=a,this._triangles[e-1+"_"+r].setColor(colorMap[n[e-1][r]]),this._triangles[e-1+"_"+(r+1)].setColor(colorMap[n[e-1][r+1]]),this._triangles[e-1+"_"+(r+2)].setColor(colorMap[n[e-1][r+2]]),this._triangles[e+"_"+i].setColor(colorMap[n[e][i]]),this._triangles[e+"_"+(i+1)].setColor(colorMap[n[e][i+1]]),this._triangles[e+"_"+(i+2)].setColor(colorMap[n[e][i+2]]),this._triangles[e-1+"_"+r].draw(),this._triangles[e-1+"_"+(r+1)].draw(),this._triangles[e-1+"_"+(r+2)].draw(),this._triangles[e+"_"+i].draw(),this._triangles[e+"_"+(i+1)].draw(),this._triangles[e+"_"+(i+2)].draw(),game.isStarted=!game.check()}},t.prototype.onAddToStage=function(e){this.initGraphic()},t.prototype.refresh=function(){for(var e=0;e<Game.BOARD_DIM.length;e++)for(var t=0;t<Game.BOARD_DIM[e];t++)this._triangles[e+"_"+t].setColor(colorMap[game.Board[e][t]]),this._triangles[e+"_"+t].draw()},t}(eui.Component);__reflect(GameBoard.prototype,"GameBoard");var InfoPanel=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.clear=function(){this.removeChildren()},t.prototype.draw=function(e){this.width=500,this.height=500;var t=new egret.Shape;t.graphics.beginFill(1381653,.8),t.graphics.drawRoundRect(0,0,500,500,50,50),t.graphics.endFill(),this.addChild(t);var r=new egret.TextField;r.text=e,r.textColor=16711680,r.multiline=!0,r.textAlign="center",r.verticalAlign="center",r.width=500,r.height=500,r.size=52,this.addChild(r),r.y=200},t}(eui.Component);__reflect(InfoPanel.prototype,"InfoPanel");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.infoPanel=new InfoPanel,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return r.sent(),this.stage.removeChild(e),[3,5];case 4:return t=r.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,r){var i=new eui.Theme("resource/default.thm.json",e.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=this,t=new egret.Bitmap;t.texture=RES.getRes("bg_jpg"),this.addChild(t);var r=this.stage.stageWidth,i=this.stage.stageHeight;t.width=r,t.height=i;var n=new egret.Shape;n.graphics.beginFill(0,.65),n.graphics.drawRect(0,0,r,i),n.graphics.endFill(),this.addChild(n);var a=new egret.TextField;a.text="旋转方块",a.x=220,a.y=30,a.fontFamily="华文行楷",a.size=45,this.addChild(a);var o=new egret.TextField;o.text="简单",o.x=80,o.y=120,this.addChild(o);var s=new egret.TextField;s.text="耗时(s) : ",s.x=380,s.y=120,this.addChild(s),this.timecnt=new egret.TextField,this.timecnt.text="0",this.timecnt.x=500,this.timecnt.y=120,this.addChild(this.timecnt);var h=new eui.ToggleSwitch;this.levelSwith=h,h.x=160,h.y=120,this.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.level=h.selected?2:1,o.text=h.selected?"困难":"简单"},this);var l=new eui.Button;l.label="开始游戏",l.x=250,l.y=110,this.addChild(l),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),this.gameBoard=new GameBoard,this.gameBoard.scaleY=.866,this.addChild(this.gameBoard);var c=new egret.TextField;c.text="目标图形",c.x=60,c.y=820,this.addChild(c),this.info=new egret.TextField,this.info.text="",this.info.textColor=16711680,this.info.size=34,this.info.x=400,this.info.y=820,this.addChild(this.info);var d=new GameBoard(!0);d.x=150,d.y=800,d.scaleX=.4,d.scaleY=.346,this.addChild(d),this.infoPanel.x=70,this.infoPanel.y=220,this.addChild(this.infoPanel)},t.prototype.onButtonClick=function(e){var t=this;game.start(this.levelSwith.selected?2:1),this.gameBoard.refresh(),this.timecnt.text="0",this.info.text="",this.infoPanel.clear(),this.timer&&this.timer.stop(),this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,function(){if(!game.isStarted)return t.info.text="成功解答!",void t.timer.stop();var e=parseInt(t.timecnt.text);t.timecnt.text=""+(e+1)},this),this.timer.start()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,r,i){function n(e){t.call(i,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),r.call(i))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,r){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(i,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var h=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(i,generateJSON.paths[e])},this):RES.getResByUrl(h,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){t.call(i,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);