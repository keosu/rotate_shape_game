function randomColor(){var t=[Color.red,Color.green,Color.blue,Color.yellow,Color.pink,Color.cyan,Color.purple,Color.olive,Color.teal];return t[Math.floor(Math.random()*t.length)]}function randomShape(){var t=Object.values(BrickShape);return t[Math.floor(Math.random()*t.length)]}var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(s,a){function o(t){try{h(i.next(t))}catch(e){a(e)}}function n(t){try{h(i["throw"](t))}catch(e){a(e)}}function h(t){t.done?s(t.value):new r(function(e){e(t.value)}).then(o,n)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return i([t,e])}}function i(r){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,a=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){h.label=r[1];break}if(6===r[0]&&h.label<o[1]){h.label=o[1],o=r;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(r);break}o[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(i){r=[6,i],a=0}finally{s=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var s,a,o,n,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function i(i){e.call(r,i,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?i(s):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Color;!function(t){t[t.bg=11184810]="bg",t[t.grey=8421504]="grey",t[t.dark=1118481]="dark",t[t.orange=15761536]="orange",t[t.red=16711680]="red",t[t.green=65280]="green",t[t.blue=255]="blue",t[t.yellow=16776960]="yellow",t[t.pink=16711935]="pink",t[t.cyan=65535]="cyan",t[t.purple=8388736]="purple",t[t.olive=134742016]="olive",t[t.teal=32896]="teal"}(Color||(Color={}));var Squar=function(t){function e(e,r,i){void 0===e&&(e=Color.bg),void 0===r&&(r=Color.grey),void 0===i&&(i=1);var s=t.call(this)||this;return s.fillColor=e,s.lineColor=r,s.lineWidth=i,s.addEventListener(egret.Event.ADDED_TO_STAGE,s.onAddToStage,s),s}return __extends(e,t),e.prototype.onAddToStage=function(t){this.draw()},e.prototype.draw=function(){this.graphics.clear(),this.graphics.lineStyle(this.lineWidth,this.lineColor),this.graphics.beginFill(Color.bg,.9),this.graphics.drawRect(0,0,e.len,e.len),this.fillColor!=Color.bg&&(this.graphics.beginFill(this.fillColor,.9),this.graphics.drawRect(1,1,e.len-2,e.len-2)),this.graphics.endFill()},e.len=60,e}(egret.Shape);__reflect(Squar.prototype,"Squar");var Board=function(t){function e(){var e=t.call(this)||this;e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.squars=new Array(10);for(var r=0;10>r;r++){e.squars[r]=new Array(10);for(var i=0;10>i;i++)e.squars[r][i]=new Squar,e.squars[r][i].x=i*Squar.len,e.squars[r][i].y=r*Squar.len,e.addChild(e.squars[r][i])}return e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.draw()},e.prototype.reset=function(){for(var t=0;10>t;t++)for(var e=0;10>e;e++)this.squars[t][e].fillColor=Color.bg;this.draw()},e.prototype.draw=function(){for(var t=0;10>t;t++)for(var e=0;10>e;e++)this.squars[t][e].draw()},e.prototype.rowCheck=function(t){for(var e=0;10>e;e++)if(this.squars[t][e].fillColor==Color.bg)return!1;return!0},e.prototype.colCheck=function(t){for(var e=0;10>e;e++)if(this.squars[e][t].fillColor==Color.bg)return!1;return!0},e.prototype.place=function(t,e,r){for(var i=this,s=0,a=0;a<r.Shape.length;a++){r.Shape[a].length>s&&(s=r.Shape[a].length);for(var o=0;o<r.Shape[a].length;o++)0!=r.Shape[a][o]&&(this.squars[t+a][e+o].fillColor=r.color,this.squars[t+a][e+o].draw())}for(var n=0,h=[],c=[],a=t;a<t+r.Shape.length;a++)this.rowCheck(a)&&(n++,h.push(a));for(var a=e;e+s>a;a++)this.colCheck(a)&&(n++,c.push(a));return h.forEach(function(t){for(var e=0;10>e;e++)i.squars[t][e].fillColor=Color.bg,i.squars[t][e].draw()}),c.forEach(function(t){for(var e=0;10>e;e++)i.squars[e][t].fillColor=Color.bg,i.squars[e][t].draw()}),n},e.prototype.tryPlace=function(t,e,r){for(var i=0;i<r.Shape.length;i++)for(var s=0;s<r.Shape[i].length;s++){if(e+s>9||t+i>9)return!1;if(this.squars[t+i][e+s].fillColor!=Color.bg&&0!=r.Shape[i][s])return!1}return!0},e.prototype.isPlacable=function(t){for(var e=0;10>e;e++)for(var r=0;10>r;r++)if(this.tryPlace(e,r,t))return!0;return!1},e}(eui.Component);__reflect(Board.prototype,"Board");var MarkShape=function(t){function e(){var e=t.call(this)||this;return e.draw(),e}return __extends(e,t),e.prototype.draw=function(){this.graphics.clear()},e.prototype.drawTick=function(){this.graphics.clear(),this.graphics.beginFill(3355443,.7),this.graphics.lineStyle(2,2434341),this.graphics.drawCircle(0,0,20),this.graphics.endFill(),this.graphics.lineStyle(4,65280),this.graphics.moveTo(-10,-3),this.graphics.lineTo(-2,8),this.graphics.lineTo(10,-8)},e.prototype.drawError=function(){this.graphics.clear(),this.graphics.beginFill(3355443,.7),this.graphics.lineStyle(2,2434341),this.graphics.drawCircle(0,0,20),this.graphics.endFill(),this.graphics.lineStyle(4,16711680),this.graphics.moveTo(-8,-8),this.graphics.lineTo(8,8),this.graphics.moveTo(-8,8),this.graphics.lineTo(8,-8)},e}(egret.Shape);__reflect(MarkShape.prototype,"MarkShape");var Brick=function(t){function e(e,r,i){void 0===e&&(e=Color.red),void 0===r&&(r=[]),void 0===i&&(i=!1);var s=t.call(this)||this;return s.color=e,s._shape=r,s.isShadow=i,s.addEventListener(egret.Event.ADDED_TO_STAGE,s.onAddToStage,s),s}return __extends(e,t),e.prototype.onAddToStage=function(t){this.draw()},e.prototype.draw=function(){var t=this.isShadow?Color.grey:this.color,e=this.isShadow?Color.yellow:Color.dark,r=this.isShadow?2:1;this.graphics.clear(),this.graphics.beginFill(t,.8),this.graphics.lineStyle(r,e);for(var i=0;i<this.Shape.length;i++)for(var s=0;s<this.Shape[i].length;s++)0!=this.Shape[i][s]&&this.graphics.drawRect(s*Squar.len+1,i*Squar.len+1,Squar.len-2,Squar.len-2);this.graphics.endFill()},Object.defineProperty(e.prototype,"Shape",{get:function(){return this._shape},set:function(t){this._shape=t,this.graphics.clear();for(var e=0;e<this.Shape.length;e++)for(var r=0;r<this.Shape[e].length;r++)0!=this.Shape[e][r]&&this.graphics.drawRect(r*Squar.len,e*Squar.len,Squar.len,Squar.len)},enumerable:!0,configurable:!0}),e}(egret.Shape);__reflect(Brick.prototype,"Brick");var BrickStatus;!function(t){t[t.Placed=0]="Placed",t[t.Placeable=1]="Placeable",t[t.Forbidden=2]="Forbidden"}(BrickStatus||(BrickStatus={}));var StageBrick=function(){function t(){this.brick=new Brick,this.mark=new MarkShape,this.status=BrickStatus.Placeable}return t}();__reflect(StageBrick.prototype,"StageBrick");var BrickShape={L:[[1],[1],[1,1,1]],L_Mirror:[[0,0,1],[0,0,1],[1,1,1]],L_UPDOWN:[[1,1,1],[1],[1]],L_UPDOWN_Mirror:[[1,1,1],[0,0,1],[0,0,1]],T:[[1,1,1],[0,1],[0,1]],T_LRotate:[[1],[1,1,1],[1]],T_UPDOWN:[[1],[1],[1,1,1]],T_RRotate:[[0,0,1],[1,1,1],[0,0,1]],N:[[0,0,1],[1,1,1],[1]],N_LRotate:[[1,1],[0,1],[0,1,1]],N_UPDOWN:[[1],[1,1,1],[0,0,1]],N_UPDOWN_Mirror:[[0,0,1],[1,1,1],[1]],C:[[1,1],[1],[1,1]],C_LRotate:[[1,0,1],[1,1,1]],C_RRotate:[[1,1,1],[1,0,1]],C_Mirror:[[1,1],[0,1],[1,1]],Rec_2:[[1,1],[1,1]],Rec_3:[[1,1,1],[1,1,1],[1,1,1]],Dot:[[1]],Wide:[[1,1,1,1]],Tall:[[1],[1],[1],[1]],1:[[1],[1,1]],2:[[0,1],[1,1]],3:[[1,1],[1]],4:[[1,1],[0,1]],5:[[1,1,1],[0,1]],6:[[1],[1,1],[1]],7:[[0,1],[1,1],[0,1]],8:[[0,1],[1,1,1]],9:[[1,1]],10:[[1],[1]],11:[[1,1,1]],12:[[1],[1],[1]],21:[[1,1],[0,1,1]],22:[[0,1,1],[1,1]],23:[[1,0],[1,1],[0,1]],24:[[0,1],[1,1],[1]],551:[[1],[1,1]],552:[[0,1],[1,1]],553:[[1,1],[1]],554:[[1,1],[0,1]],555:[[1,1,1],[0,1]],556:[[1],[1,1],[1]],557:[[0,1],[1,1],[0,1]],558:[[0,1],[1,1,1]],559:[[1,1]],510:[[1],[1]],511:[[1,1,1]],512:[[1],[1],[1]]},InfoPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.clear=function(){this.removeChildren()},e.prototype.draw=function(t){this.width=500,this.height=500;var e=new egret.Shape;e.graphics.beginFill(1381653,.7),e.graphics.drawRoundRect(0,0,500,500,50,50),e.graphics.endFill(),this.addChild(e);var r=new egret.TextField;r.text=t,r.textColor=16711680,r.multiline=!0,r.textAlign="center",r.verticalAlign="center",r.width=500,r.height=500,r.size=52,this.addChild(r),r.y=200},e}(eui.Component);__reflect(InfoPanel.prototype,"InfoPanel");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.info=new InfoPanel,e.brick=new Brick,e._stageBricks=new Array(3),e._touchStatus=!1,e._distance=new egret.Point,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return r.sent(),this.stage.removeChild(t),[3,5];case 4:return e=r.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,r){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=new egret.Bitmap;t.texture=RES.getRes("bg_jpg"),this.addChild(t);var e=this.stage.stageWidth,r=this.stage.stageHeight;t.width=e,t.height=r;var i=new egret.Shape;i.graphics.beginFill(0,.6),i.graphics.drawRect(0,0,e,172),i.graphics.endFill(),i.y=33,this.addChild(i);var s=new egret.Shape;s.graphics.beginFill(0,.7),s.graphics.drawRect(10,0,e-20,200),s.graphics.endFill(),s.y=840,this.addChild(s);var a=new egret.TextField;a.text="方块消除",a.size=42,a.x=250,a.y=80,this.addChild(a);var o=new eui.Button;o.label="重新开始",o.x=280,o.y=150,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartBtClick,this),this.addChild(o);var n=new egret.TextField;n.text="得分：",n.x=420,n.y=150,this.addChild(n),this._score=new egret.TextField,this._score.text="0",this._score.x=520,this._score.y=150,this.addChild(this._score),this.bd=new Board,this.bd.x=20,this.bd.y=220,this.addChild(this.bd),this.info.x=70,this.info.y=270,this.addChild(this.info);var h=new egret.Shape;h.graphics.lineStyle(8,3355443),h.graphics.drawRect(16,216,608,608),this.addChild(h),this.shadow=new Brick(0,[],!0),this.addChild(this.shadow);for(var c=0;3>c;c++)this._stageBricks[c]=new StageBrick,this.addChild(this._stageBricks[c].brick),this.addChild(this._stageBricks[c].mark),this._stageBricks[c].brick.touchEnabled=!0,this._stageBricks[c].brick.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this);this.resetBricks(),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this)},e.prototype.onStartBtClick=function(t){this.Score=0,this.info.clear(),this.bd.reset(),this.resetBricks()},Object.defineProperty(e.prototype,"Score",{get:function(){return parseInt(this._score.text)},set:function(t){this._score.text=t.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._lastCol},set:function(t){this._lastCol=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._lastRow},set:function(t){this._lastRow=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BrickNum",{get:function(){return this._brickNum},set:function(t){this._brickNum=t,0==t&&this.resetBricks()},enumerable:!0,configurable:!0}),e.prototype.updateStatus=function(){for(var t=0,e=0;3>e;e++){var r=this._stageBricks[e];r.status!=BrickStatus.Placed?this.bd.isPlacable(r.brick)?(r.mark.drawTick(),r.status=BrickStatus.Placeable,r.brick.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),t++):(r.mark.drawError(),r.status=BrickStatus.Forbidden,r.brick.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this)):r.mark.draw()}0===t&&this.info.draw("游戏结束!")},e.prototype.resetBricks=function(){this.BrickNum=3;for(var t=0;3>t;t++)this._stageBricks[t].brick.color=randomColor(),this._stageBricks[t].brick.Shape=randomShape(),this._stageBricks[t].brick.x=100+200*t,this._stageBricks[t].brick.y=850,this._stageBricks[t].brick.scaleX=.5,this._stageBricks[t].brick.scaleY=.5,this._stageBricks[t].brick.draw(),this._stageBricks[t].mark.x=150+200*t,this._stageBricks[t].mark.y=980,this._stageBricks[t].status=BrickStatus.Placeable;this.updateStatus()},e.prototype.mouseDown=function(t){var e=t.currentTarget;this.brick=e,this._touchStatus=!0,e.y-=200,this._distance.x=t.stageX-e.x,this._distance.y=t.stageY-e.y,this._curBrickX=e.x,this._curBrickY=e.y+200,e.scaleX=e.scaleY=1,this.setChildIndex(e,this.numChildren-1),this.shadow.Shape=e.Shape,this.shadow.draw(),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseMove=function(t){var e=this.brick;if(this._touchStatus){var r=t.stageX-this._distance.x,i=t.stageY-this._distance.y;r>this.bd.x&&r<this.bd.x+570&&i>this.bd.y&&i<this.bd.y+570&&(this.col=Math.round((r-this.bd.x)/60),this.row=Math.round((i-this.bd.y)/60),this.isPlacable=this.bd.tryPlace(this.row,this.col,e),this.isPlacable?(this.shadow.x=this.col*Squar.len+this.bd.x,this.shadow.y=this.row*Squar.len+this.bd.y):this.shadow.x=-500),e.x=r,e.y=i}},e.prototype.mouseUp=function(t){this._touchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this);for(var e=[0,100,300,500,800,1e3],r=this.brick,i=0,s=0;3>s;s++)if(r==this._stageBricks[s].brick){i=s;break}if(r){if(r.x=this._curBrickX,r.y=this._curBrickY,r.scaleX=r.scaleY=.5,this.isPlacable){var a=this.bd.place(this.row,this.col,this.brick);this.Score+=e[a],this._stageBricks[i].status=BrickStatus.Placed,r.x=-500,this.BrickNum--,this.updateStatus(),this.isPlacable=!1}this.shadow.x=-500}this.brick=null},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,i){function s(t){e.call(i,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),r.call(i))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,r){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var n=t.split("/");n.pop();var h=n.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(h,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){e.call(i,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);